{% extends 'base.html.twig' %}
{% import "form/_form.html.twig" as _form %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
    <div class="row justify-content-center">
        <div class="col-12 col-md-8">
            <h1>{{ post.title }}</h1>
            <hr>
            <p class="lead my-5">{{ post.lead }}</p>
            <p>{{ post.content|nl2br }}</p>
            <hr class="mt-5">
            <p>By {{ post.user.username ?: '<span class="text-muted"><i>Deleted account</i></span>' }}</p>
            <p style="color: grey">
                {% if post.createdAt|date('Y-m-d H:i:s') is same as(post.updatedAt|date('Y-m-d H:i:s')) %}
                    Published the {{ post.createdAt|date('Y-m-d \\a\\t H:i:s') }}
                {% else %}
                    Updated the {{ post.updatedAt|date('Y-m-d \\a\\t H:i:s') }}
                {% endif %}
            </p>
        </div>
    </div>
    <div class="row justify-content-center">
        {% if 'user' in app.user.roles %}
            <div class="col-12 col-md-8">
                <div class="card my-4">
                    <h5 class="card-header">Leave a comment</h5>
                    <div class="card-body">
                        <form method="POST">
                            {{ _form.message_csrf(form) }}
                            <div class="form-group">
                                {% if form.errors.content is not null %}<div class="invalid-feedback">{{ form.errors.content }}</div>{% endif %}
                                <textarea class="form-control" rows="3" name="content" minlength="10" maxlength="1000" required>{{ form.content }}</textarea>
                                {% if 'admin' not in app.user.roles %}
                                    <small id="isPublishedHelp" class="form-text text-muted">The comment will be submitted to validation before publication.</small>
                                {% endif %}  
                            </div>
                            {{ _form.input_csrf(csrf_token()) }}
                            <button type="submit" class="btn btn-primary float-right">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="col-12 col-md-8 my-5">
            <h2>Comments</h2>
            <hr>
            {% for comment in comments %}
                <div class="media my-3">
                    <div class="media-body">
                        <h5 class="mb-0"><b>{{ comment.user.username }}</b></h5>
                        <small style="color: grey">{{ comment.updatedAt|date('Y-m-d \\a\\t H:i:s') }}</small>
                        <p class="mt-2">{{ comment.content}}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="/css/form.css">
{% endblock %}